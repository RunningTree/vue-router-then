"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},routerThen={$router:null,resolve:null,request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"push",o=arguments[1],t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!o||""==o)throw new Error("location is missing");return new Promise(function(l,u){if(t.$router)switch(console.log("this.$router",t.$router),t.resolve=l,e){case"push":t.$router.push(o,n,r);break;case"replace":t.$router.replace(o,n,r);break;case"go":t.$router.go(o);break;default:u("requestType error:"+e)}else u("$router missing")}).catch(function(e){throw t.resolve=null,new Error(e)})},push:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.request("push",e,o,t)},replace:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.request("replace",e,o,t)},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.request("go",e)},modelLink:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.push(e).then(function(e){return console.log("then",e),e.$once("input",function(e){if(console.log("modellink.input",o,e),"function"==typeof o)o(e);else if("object"==(void 0===o?"undefined":_typeof(o)))if(o.$emit)o.$emit("input",e);else if(o.tagName){o.value=e;var t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0),o.dispatchEvent(t)}}),e})},clickElFun:function(e){var o=this.getAttribute("model-link");return o?(console.log(this),routerThen.modelLink(o,this.vnode&&this.vnode.componentInstance?this.vnode.componentInstance:this)):Promise.resolve()}};exports.default={install:function(e){Object.defineProperty(e.prototype,"$routerThen",{value:routerThen}),e.directive("model-link",function(e,o,t){e.binding=o,e.vnode=t,e.setAttribute("model-link",o.value),e.removeEventListener("click",routerThen.clickElFun),e.addEventListener("click",routerThen.clickElFun)}),e.mixin({beforeRouteEnter:function(e,o,t){console.log("routerThen.resolve",routerThen.resolve),routerThen.resolve?t(function(e){routerThen.resolve(e),routerThen.resolve=null}):t(),console.log("model-link.beforeRouteEnter",e,o,t)},beforeRouteUpdate:function(e,o,t){console.log("routerThen.resolve",routerThen.resolve),routerThen.resolve&&(routerThen.resolve(this),routerThen.resolve=null),t(),console.log("model-link.beforeRouteUpdate",e,o,t)}})},initRouter:function(e){routerThen.$router=e}};